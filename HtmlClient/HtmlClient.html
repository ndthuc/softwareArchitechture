<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th√®ArtShop - HtmlClient</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>

        const cors = "https://cors-anywhere.herokuapp.com/";
        const domain = "http://tin415de01.gear.host/"

        function page_load() {
            getAll();
        }

        function getAll() {
            axios.get(cors + domain + "api/arts").then((res) => {
                var artItems = res.data;
                renderArtItemsList(artItems);
            })
        }

        function renderArtItemsList(items) {
            var header = "<tr><th>Code</th><th>Name</th><th>Category</th><th>Price</th><th>Brand</th></tr>";
            var rows = "";
            for (var item of items) {
                rows += "<tr onclick='viewDetails(" + item.Code + ")' style='cursor:pointer'>";
                rows += "<td>" + item.Code + "</td>";
                rows += "<td>" + item.Name + "</td>";
                rows += "<td>" + item.Category + "</td>";
                rows += "<td>" + item.Price + "</td>";
                rows += "<td>" + item.Brand + "</td>";
                rows += "</tr>";
            }
            document.getElementById("listItems").innerHTML = header + rows;
        }

        function viewDetails(code) {
            getItemDetails(code);
        }

        function getItemDetails(code) {
            axios.get(cors + domain + "api/arts/" + code)
                .then((res) => {
                    var artItem = res.data;
                    document.getElementById("Code").value = artItem.Code;
                    document.getElementById("Name").value = artItem.Name;
                    document.getElementById("Category").value = artItem.Category;
                    document.getElementById("Price").value = artItem.Price;
                    document.getElementById("Brand").value = artItem.Brand;
                });
        }

        function addNewItem() {
            var newItem = {
                "Code": 9,
                "Name": document.getElementById("Name").value,
                "Category": document.getElementById("Category").value,
                "Price": document.getElementById("Price").value,
                "Brand": document.getElementById("Brand").value
            }
            axios.post(cors + domain + "api/arts", newItem)
                .then((res) => {
                    var result = res.data;
                    if (result) {
                        getAll();
                    } else {
                        alert("sorry, something wrong!!! can`t add new item!!!")
                    }
                })
        }

        function updateItem() {
            var code = document.getElementById("Code").value;
            var updatedItem = {
                Code: code,
                Name: document.getElementById("Name").value,
                Category: document.getElementById("Category").value,
                Price: document.getElementById("Price").value,
                Brand: document.getElementById("Brand").value,
            };

            axios.put(cors + domain + "api/arts/" + code, updatedItem)
                .then((res) => {
                    var result = res.data;
                    if (result) {
                        getAll();
                    } else {
                        alert("sorry, something wrong!!! can`t update item!!!")
                    }
                });
        }

        function deleteItem() {
            if (confirm("Are you sure?")) {
                var code = document.getElementById("Code").value;
                axios.delete(cors + domain + "api/arts/" + code)
                .then((res) => {
                    var result = res.data;
                    if (result) {
                        getAll();
                    } else {
                        alert("sorry, something wrong!!! can`t delete item!!!")
                    } 
                });
            }
        }

        function searchItems() {
            var keyword = document.getElementById("Keyword").value;

            if (keyword.length > 0) {
                axios.get(cors + domain + "api/arts/search/" + keyword)
                .then((res) =>{
                    var items = res.data;
                    renderArtItemsList(items);
                });
            } else {
                getAll();
            }
        }
    </script>
</head>

<body onload="page_load()">
    <h1>LIST ITEM</h1>

    <input type="text" name="" id="Keyword">
    <button onclick="searchItems()">SEARCH</button>

    <table id="listItems" border="1"></table>

    <h1>Details</h1>
    <label for="id">Code</label>
    <input type="text" name="item id" id="Code" disabled = "disabled">
    <br>
    <label for="name">Name</label>
    <input type="text" name="item name" id="Name">
    <br>
    <label for="category">Category</label>
    <input type="text" name="item category" id="Category">
    <br>
    <label for="price">Price</label>
    <input type="text" name="item price" id="Price">
    <br>
    <label for="brand">Brand</label>
    <input type="text" name="item brand" id="Brand">
    <br>
    <button onclick="addNewItem()">Add New</button>
    <button onclick="updateItem()">Update</button>
    <button onclick="deleteItem()">Delete</button>
</body>

</html>